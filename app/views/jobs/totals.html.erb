<% if params[:start_date] || params[:end_date] %>
	<h1>Totals for <%= params[:start_date].to_time.strftime('%m/%d/%Y')%> - <%= params[:end_date].to_time.strftime('%m/%d/%Y')%></h1>
<% else %>
	<h1>Totals for <%= @begin_time.strftime('%m/%d/%Y') %> - <%= @end_time.strftime('%m/%d/%Y') %></h1>
<% end %>

<%= link_to 'Back', root_path %>

<%= form_tag(totals_path ,:method => 'get', id: 'date_range')  do  %>
	<%= label :start_date, "Start: " %>
	<%= date_field_tag :start_date, params[:start_date], id: 'start_date' %>
	<%= label :end_date, "End: "%>
	<%= date_field_tag :end_date, params[:end_date], placeholder: 'End Date', id: 'end_date'%>
	<%= submit_tag 'Search', :name => nil %>
<% end %>

<% if params[:start_date] || params[:end_date] %>
	<table>
		<tr>
			<td><strong>Total Jobs:</strong></td>
			<td><strong><%= @jobs.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").count %></strong></td>
		</tr>
		<tr>
			<td><strong>Total AU Jobs:</strong></td>
			<td><%= @au_jobs.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").count %></td>
		</tr>
		<tr>
			<td><strong>Total CHOG Jobs:</strong></td>
			<td><%= @chog_jobs.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").count %></td>
		</tr>
		<tr>
			<td><hr /></td>
		</tr>
		<tr>
			<td><strong>Total Hours:</strong></td>
			<td><strong><%= @jobs.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").sum(:time_spend) %></strong></td>
		</tr>
		<tr>
			<td><strong>Total AU Hours:</strong></td>
			<td><%= @total_au.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").sum(:time_spend) %></td>
		</tr>
		<tr>
			<td><strong>Total CHOG Hours:</strong></td>
			<td><%= @total_chog.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}").sum(:time_spend) %></td>
		</tr>
	</table>
	
	<h3>Total Jobs</h3>
		<%= pie_chart Job.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}")
			.group(:au_chog).count,  donut: true %>

	<h3>Total Hours</h3>
		<%= pie_chart Job.where("start_date >= ? and end_date <= ?", "#{params[:start_date]}", "#{params[:end_date]}")
			.group(:au_chog).sum(:time_spend), donut: true %>

<% else %>
	<table>
		<tr>
			<td><strong>Total Jobs:</strong></td>
			<td><strong><%= @jobs.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").count %></strong></td>
		</tr>
		<tr>
			<td><strong>Total AU Jobs:</strong></td>
			<td><%= @au_jobs.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").count %></td>
		</tr>
		<tr>
			<td><strong>Total CHOG Jobs:</strong></td>
			<td><%= @chog_jobs.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").count %></td>
		</tr>
		<tr>
			<td><hr /></td>
		</tr>
		<tr>
			<td><strong>Total Hours:</strong></td>
			<td><strong><%= @jobs.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").sum(:time_spend) %></strong></td>
		</tr>
		<tr>
			<td><strong>Total AU Hours:</strong></td>
			<td><%= @total_au.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").sum(:time_spend) %></td>
		</tr>
		<tr>
			<td><strong>Total CHOG Hours:</strong></td>
			<td><%= @total_chog.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").sum(:time_spend) %></td>
		</tr>
	</table>
	
	<h3>Total Jobs</h3>
		<%= pie_chart Job.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").group(:au_chog).count,  donut: true %>


	<h3>Total Hours</h3>
		<%= pie_chart Job.where("start_date >= ? and end_date <= ?", "#{@begin_time}", "#{@end_time}").group(:au_chog).sum(:time_spend), donut: true %>
<% end %>